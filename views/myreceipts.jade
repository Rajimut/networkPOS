extends layout
include mixins/navbar-buyer.jade
//- include mixins/mixin-receipt.jade
block content
  +buyer-nav(['','','active','','','',''])


block holder

  //- div.test
  //-   each val in myreceipt_
  //-     each val_ in val.item_details
  //-       div p #{val_}
  div#receiptModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='basicModal', aria-hidden='true')
    .modal-dialog
      .modal-content
        //-.modal-header
          button.close(type='button', data-dismiss='modal', aria-hidden='true')
          //- h4#myModalLabel.modal-title Modal title
        .modal-body
          //- +receipt_template()
        //-.modal-footer
          //- .col-xs-12.col-sm-12.col-md-12.text-center
          //-   button.btn.btn-default.text-center(type='button', data-dismiss='modal') Close
              //- button.btn.btn-primary(type='button') Save
        //- script(type='text/javascript').
        //-   $('#receiptModal').on('show.bs.modal', function () {
        //-     $('.modal .modal-body').css('overflow-y', 'auto'); 
        //-     $('.modal .modal-body').css('max-height', $(window).height() * 0.7);
        //-     });
  .row
    .col-md-12
      #sync1.owl-carousel
        each val in myreceipt_
          |              
          div.item
            .row
              .col-md-4.col-sm-6.col-xs-6
                img.img-responsive.center-block(src='img/coffe2.jpg',  width='100%',alt='Responsive image')
              .col-md-4.col-sm-6.col-xs-6.col-md-push-4
                img.img-responsive.center-block(src='img/map.jpg', width='100%', alt='Responsive image')
              .col-md-4.col-sm-12.col-xs-12.col-md-pull-4
                .row.text-center
                  h4.col-xs-6.col-sm-6.col-md-12.text-responsive 
                    img.img-responsive.center-block(src='img/Sample_logo_500px.png',  width='55%',alt='Responsive image')
                  h3.col-xs-6.col-sm-6.col-md-12  
                    | $#{val.aftertax}             
                  h4.col-xs-6.col-sm-6.col-md-12
                    em Receipt #: #{val.transaction_id}
                  h4.col-xs-6.col-sm-6.col-md-12
                    em #{val.transaction_date.toDateString()},     #{val.paymenttype}
                  p
                  |                                     
                  |                                                                           
                div
                  a.btn.btn-lg.btn-success.detailreceipt(receipt-id='#{val.transaction_id}') Details
                  //- (href='#receiptModal', data-toggle='modal',data-receipt-id='#{val.transaction_id}', data-target='#receiptModal') Details

      .row  
        #sync2.owl-carousel
          each val in myreceipt_
            |           
            div.item 
              img.img-responsive.center-block(src='img/Sample_logo_500px.png',  width='70%',alt='Responsive image')    
              h1 
              //-|  #{val.seller_name}
              h1
              | $#{val.aftertax}             
              h1                      
              span.large #{val.transaction_date.toDateString()}
              p
              p                                                                 
              //.col-xs-12.col-sm-12.col-md-12.text-center        
                div
                  a.btn.btn-lg.btn-success.detailreceipt(receipt-id='#{val.transaction_id}') Details

  script(type='text/javascript').
    $(document).on('click', '.detailreceipt', function() {
    //- e.preventDefault();
    var receipt_ID = $(this).attr('receipt-id');
    console.log('hel '+receipt_ID);
    $('#receiptModal .modal-body').load('/singlereceipt/' + receipt_ID, function() {
      $('#receiptModal').modal();
    });
    });
  script(type='text/javascript').  
    $(document).ready(function() {     
      var sync1 = $("#sync1");
      var sync2 = $("#sync2");
       
      sync1.owlCarousel({
      items : 1,
      itemsDesktop : [1199,1],
      itemsDesktopSmall : [979,1],
      itemsTablet : [768,1],
      itemsMobile : [479,1],
      slideSpeed : 1000,
      navigation: true,
      pagination:false,
      afterAction : syncPosition,
      //paginationNumbers : true,
      responsiveRefreshRate : 200,
      });
       
      sync2.owlCarousel({
      items : 5,
      itemsDesktop : [1199,5],
      itemsDesktopSmall : [979,3],
      itemsTablet : [768,4],
      itemsMobile : [479,3],
      slideSpeed : 2000,
      //pagination:true,
      paginationNumbers : true,
      responsiveRefreshRate : 200,
      afterInit : function(el){
      el.find(".owl-item").eq(0).addClass("synced");
      }
      });
       
      function syncPosition(el){
      var current = this.currentItem;
      $("#sync2")
      .find(".owl-item")
      .removeClass("synced")
      .eq(current)
      .addClass("synced")
      if($("#sync2").data("owlCarousel") !== undefined){
      center(current)
      }
      }
       
      $("#sync2").on("click", ".owl-item", function(e){
      e.preventDefault();
      var number = $(this).data("owlItem");
      sync1.trigger("owl.goTo",number);
      });
     
      function center(number){
        var sync2visible = sync2.data("owlCarousel").owl.visibleItems;
        var num = number;
        var found = false;
        for(var i in sync2visible){
        if(num === sync2visible[i]){
        var found = true;
        }
        }
         
        if(found===false){
        if(num>sync2visible[sync2visible.length-1]){
        sync2.trigger("owl.goTo", num - sync2visible.length+2)
        }else{
        if(num - 1 === -1){
        num = 0;
        }
        sync2.trigger("owl.goTo", num);
        }
        } else if(num === sync2visible[sync2visible.length-1]){
        sync2.trigger("owl.goTo", sync2visible[1])
        } else if(num === sync2visible[0]){
        sync2.trigger("owl.goTo", num-1)
        }
        }
       
    });

